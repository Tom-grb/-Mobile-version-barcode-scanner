"use strict";const t=require("../../common/vendor.js");require("../../uni_modules/uni-id-pages/common/store.js");const o=require("../../common/assets.js"),s=t.er.importObject("goodsInfoObj"),i={data:()=>({goodsList:[],scanning:!1,lastScanTime:0}),computed:{totalPrice(){return this.goodsList.reduce(((t,o)=>t+o.goods_price*o.quantity),0).toFixed(2)}},methods:{handleScanWithThrottle(t){const o=Date.now();this.scanning||o-this.lastScanTime<2e3||(this.lastScanTime=o,this.handleScan(t))},async handleScan(o){if(!this.scanning){this.scanning=!0;try{const i=o.detail.result;console.log("handleScan",i);const e=this.goodsList.find((t=>t.goods_sn===i));if(e){const t=this.goodsList.indexOf(e);return this.updateQuantity(t,1),void(this.scanning=!1)}const n=await s.findGoods(i);if(0===n.code){const t=n.data;this.goodsList.unshift({...t,quantity:1,isNew:!0}),setTimeout((()=>{this.goodsList[0].isNew=!1}),500)}else-1===n.code?setTimeout((()=>{t.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"})}),1e3):t.index.showToast({title:"商品不存在",icon:"error"})}catch(i){t.index.showToast({title:"扫描失败",icon:"error"})}finally{this.scanning=!1}}},updateQuantity(t,o){const s=this.goodsList[t].quantity+o;s<1||(this.goodsList[t].quantity=s)},removeItem(o){t.index.showModal({title:"提示",content:"确定要删除该商品吗？",success:t=>{t.confirm&&this.goodsList.splice(o,1)}})},showClearConfirm(){t.index.showModal({title:"提示",content:"确定要清空所有商品吗？",success:t=>{t.confirm&&(this.goodsList=[])}})}}};const e=t._export_sfc(i,[["render",function(s,i,e,n,a,d){return t.e({a:t.o(((...t)=>d.handleScanWithThrottle&&d.handleScanWithThrottle(...t))),b:a.goodsList.length>0},a.goodsList.length>0?{c:t.f(a.goodsList,((o,s,i)=>({a:t.t(o.goods_name),b:t.t(o.goods_price),c:t.o((t=>d.updateQuantity(s,-1)),s),d:o.quantity<=1?1:"",e:t.t(o.quantity),f:t.o((t=>d.updateQuantity(s,1)),s),g:t.o((t=>d.removeItem(s)),s),h:s,i:o.isNew?1:""})))}:{d:o._imports_0},{e:a.goodsList.length>0},a.goodsList.length>0?{f:t.o(((...t)=>d.showClearConfirm&&d.showClearConfirm(...t)))}:{},{g:t.t(d.totalPrice),h:a.goodsList.length>0?1:""})}]]);wx.createPage(e);
