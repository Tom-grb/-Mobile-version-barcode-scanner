"use strict";const o=require("../../common/vendor.js"),s=require("../../uni_modules/uni-id-pages/common/store.js"),e=o.er.importObject("goodsInfoObj"),n={data:()=>({showGoodsPopup:!1,currentGoods:{},newGoods:{goods_name:"",goods_price:"",goods_notes:"",goods_sn:""}}),methods:{onShareAppMessage(o){if(console.log(o),"menu"===o.from)return{title:"我的物品录",path:"/pages/home/home",imageUrl:"https://env-00jxt6l7w3we.normal.cloudstatic.cn/showPic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-02%20170114.png"}},onShareTimeline:()=>({title:"我的物品录",imageUrl:"https://env-00jxt6l7w3we.normal.cloudstatic.cn/showPic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-02%20170114.png"}),checkLogin:()=>!!s.store.hasLogin||(o.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"}),!1),goToSearch(){this.checkLogin()&&o.index.navigateTo({url:"/pages/home/search"})},popopen(){this.checkLogin()&&(this.$refs.addPopup.open(),this.newGoods={goods_name:"",goods_price:"",goods_notes:"",goods_sn:""})},async startScan(){if(this.checkLogin())try{const s=await o.index.scanCode({scanType:["barCode","qrCode"]});this.handleScanResult(s.result)}catch(s){o.index.showToast({title:"扫描失败",icon:"error"})}},async handleScanResult(s){try{const n=await e.findGoods(s);0===n.code?(this.currentGoods=n.data,this.showGoodsPopup=!0):(this.newGoods.goods_sn=s,o.index.showModal({title:"提示",content:"没有该商品信息，是否添加？",success:o=>{o.confirm&&this.$refs.addPopup.open()}}))}catch(n){o.index.showToast({title:"获取商品信息失败",icon:"error"})}},async confirmAdd(){try{if(this.newGoods.goods_price=parseFloat(this.newGoods.goods_price),console.log("this.newGoods.goods_price",this.newGoods.goods_price),isNaN(this.newGoods.goods_price)||this.newGoods.goods_price<0)return void o.index.showToast({title:"价格要求为数字且大于0",icon:"none"});const s=await e.addGoods(this.newGoods);console.log(s),o.index.showToast({title:"添加成功",icon:"success"}),this.$refs.addPopup.close(),this.newGoods={goods_name:"",goods_price:"",goods_notes:"",goods_sn:""}}catch(s){o.index.showToast({title:"添加失败",icon:"error"})}},closeAddPopup(){this.$refs.addPopup.close(),this.newGoods={goods_name:"",goods_price:"",goods_notes:"",goods_sn:""}},refreshGoods(){this.handleScanResult(this.currentGoods.goods_sn)}}};if(!Array){(o.resolveComponent("goods-popup")+o.resolveComponent("uni-popup"))()}Math||((()=>"../../components/goods-popup/goods-popup.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const d=o._export_sfc(n,[["render",function(s,e,n,d,t,i){return{a:o.o(((...o)=>i.goToSearch&&i.goToSearch(...o))),b:o.o(((...o)=>i.startScan&&i.startScan(...o))),c:o.o(((...o)=>i.popopen&&i.popopen(...o))),d:o.o((o=>t.showGoodsPopup=o)),e:o.o(i.refreshGoods),f:o.p({show:t.showGoodsPopup,goods:t.currentGoods}),g:o.o(((...o)=>i.closeAddPopup&&i.closeAddPopup(...o))),h:t.newGoods.goods_sn,i:o.o((o=>t.newGoods.goods_sn=o.detail.value)),j:t.newGoods.goods_name,k:o.o((o=>t.newGoods.goods_name=o.detail.value)),l:t.newGoods.goods_price,m:o.o((o=>t.newGoods.goods_price=o.detail.value)),n:t.newGoods.goods_notes,o:o.o((o=>t.newGoods.goods_notes=o.detail.value)),p:o.o(((...o)=>i.confirmAdd&&i.confirmAdd(...o))),q:o.sr("addPopup","5b43d928-1"),r:o.p({type:"center"})}}]]);n.__runtimeHooks=6,wx.createPage(d);
