"use strict";const o=require("../../common/vendor.js"),s=o.er.importObject("goodsInfoObj"),e={data:()=>({showGoodsPopup:!1,currentGoods:{},newGoods:{goods_name:"",goods_price:"",goods_notes:"",goods_sn:"",goods_num:""}}),methods:{onShareAppMessage(o){if(console.log(o),"menu"===o.from)return{title:"我的物品录",path:"/pages/home/home",imageUrl:"https://env-00jxt6l7w3we.normal.cloudstatic.cn/showPic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-02%20170114.png"}},onShareTimeline:()=>({title:"我的物品录",imageUrl:"https://env-00jxt6l7w3we.normal.cloudstatic.cn/showPic/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202025-03-02%20170114.png"}),gotoLogin(){o.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"})},goToSearch(){o.index.navigateTo({url:"/pages/home/search"})},popopen(){this.$refs.addPopup.open(),this.newGoods={goods_name:"",goods_price:"",goods_notes:"",goods_sn:"",goods_num:""}},async startScan(){try{const s=await o.index.scanCode({scanType:["barCode","qrCode"]});this.handleScanResult(s.result)}catch(s){o.index.showToast({title:"扫描失败",icon:"error"})}},async handleScanResult(e){try{const n=await s.findGoods(e);if(0===n.code)this.currentGoods=n.data,this.showGoodsPopup=!0;else{if(-1===n.code)return o.index.showToast({title:"未登录/登录过期",icon:"none"}),void setTimeout((()=>{this.gotoLogin()}),1e3);this.newGoods.goods_sn=e,o.index.showModal({title:"提示",content:"没有该商品信息，是否添加？",success:o=>{o.confirm&&this.$refs.addPopup.open()}})}}catch(n){o.index.showToast({title:"获取商品信息失败",icon:"error"})}},async confirmAdd(){try{if(this.newGoods.goods_price=parseFloat(this.newGoods.goods_price),isNaN(this.newGoods.goods_price)||this.newGoods.goods_price<0)return void o.index.showToast({title:"价格要求为数字且大于0",icon:"none"});if(-1===(await s.addGoods(this.newGoods)).code)return o.index.showToast({title:"未登录/登录过期",icon:"none"}),void setTimeout((()=>{this.gotoLogin()}),1e3);o.index.showToast({title:"添加成功",icon:"success"}),this.$refs.addPopup.close(),this.newGoods={goods_name:"",goods_price:"",goods_notes:"",goods_sn:"",goods_num:""}}catch(e){o.index.showToast({title:"添加失败",icon:"error"})}},closeAddPopup(){this.$refs.addPopup.close(),this.newGoods={goods_name:"",goods_price:"",goods_notes:"",goods_sn:"",goods_num:""}},refreshGoods(){this.handleScanResult(this.currentGoods.goods_sn)}}};if(!Array){(o.resolveComponent("goods-popup")+o.resolveComponent("uni-popup"))()}Math||((()=>"../../components/goods-popup/goods-popup.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const n=o._export_sfc(e,[["render",function(s,e,n,d,t,i){return{a:o.o(((...o)=>i.goToSearch&&i.goToSearch(...o))),b:o.o(((...o)=>i.startScan&&i.startScan(...o))),c:o.o(((...o)=>i.popopen&&i.popopen(...o))),d:o.o((o=>t.showGoodsPopup=o)),e:o.o(i.refreshGoods),f:o.p({show:t.showGoodsPopup,goods:t.currentGoods}),g:o.o(((...o)=>i.closeAddPopup&&i.closeAddPopup(...o))),h:t.newGoods.goods_sn,i:o.o((o=>t.newGoods.goods_sn=o.detail.value)),j:t.newGoods.goods_name,k:o.o((o=>t.newGoods.goods_name=o.detail.value)),l:t.newGoods.goods_price,m:o.o((o=>t.newGoods.goods_price=o.detail.value)),n:t.newGoods.goods_num,o:o.o((o=>t.newGoods.goods_num=o.detail.value)),p:t.newGoods.goods_notes,q:o.o((o=>t.newGoods.goods_notes=o.detail.value)),r:o.o(((...o)=>i.confirmAdd&&i.confirmAdd(...o))),s:o.sr("addPopup","5b43d928-1"),t:o.p({type:"center"})}}]]);e.__runtimeHooks=6,wx.createPage(n);
