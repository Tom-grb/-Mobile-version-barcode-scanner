"use strict";const o=require("../../common/vendor.js"),i=o.er.importObject("goodsInfoObj"),s={name:"goods-popup",props:{show:{type:Boolean,default:!1},goods:{type:Object,default:()=>({})}},data:()=>({isEditing:!1,localGoods:{}}),watch:{goods:{handler(o){this.localGoods=JSON.parse(JSON.stringify(o))},immediate:!0}},methods:{gotoLogin(){o.index.navigateTo({url:"/uni_modules/uni-id-pages/pages/login/login-withoutpwd"})},cancel(){this.isEditing=!1,this.$emit("update:show",!1)},handleEdit(){this.isEditing=!0},handleCancel(){this.isEditing=!1,this.localGoods=JSON.parse(JSON.stringify(this.goods))},async handleConfirm(){try{if(this.localGoods.goods_price=parseFloat(this.localGoods.goods_price),this.localGoods.goods_num=parseFloat(this.localGoods.goods_num),isNaN(this.localGoods.goods_price)||this.localGoods.goods_price<0)return void o.index.showToast({title:"价格要求为数字且大于0",icon:"none"});if(isNaN(this.localGoods.goods_num)||this.localGoods.goods_num<0)return void o.index.showToast({title:"数量要求为数字且大于0",icon:"none"});if(-1===(await i.updateGoods(this.localGoods)).code)return o.index.showToast({title:"未登录/登录过期",icon:"none"}),void setTimeout((()=>{this.gotoLogin()}),1e3);this.isEditing=!1,this.$emit("refresh")}catch(s){o.index.showToast({title:"更新失败",icon:"error"})}},async handleDelete(){o.index.showModal({title:"提示",content:"确定要删除该商品吗？",success:async s=>{if(s.confirm)try{if(-1===(await i.removeGoods({_id:this.goods._id})).code)return o.index.showToast({title:"未登录/登录过期",icon:"none"}),void setTimeout((()=>{this.gotoLogin()}),1e3);o.index.showToast({title:"删除成功",icon:"success"}),this.cancel(),this.$emit("refresh")}catch(e){o.index.showToast({title:"删除失败",icon:"error"})}}})}}};const e=o._export_sfc(s,[["render",function(i,s,e,t,d,n){return o.e({a:e.show},e.show?o.e({b:o.o(((...o)=>n.cancel&&n.cancel(...o))),c:d.isEditing},d.isEditing?{d:d.localGoods.goods_sn,e:o.o((o=>d.localGoods.goods_sn=o.detail.value))}:{f:o.t(e.goods.goods_sn||"暂未填写")},{g:d.isEditing},d.isEditing?{h:d.localGoods.goods_name,i:o.o((o=>d.localGoods.goods_name=o.detail.value))}:{j:o.t(e.goods.goods_name)},{k:d.isEditing},d.isEditing?{l:d.localGoods.goods_price,m:o.o((o=>d.localGoods.goods_price=o.detail.value))}:{n:o.t(e.goods.goods_price)},{o:d.isEditing},d.isEditing?{p:d.localGoods.goods_num,q:o.o((o=>d.localGoods.goods_num=o.detail.value))}:{r:o.t(e.goods.goods_num||"暂无数量")},{s:d.isEditing},d.isEditing?{t:d.localGoods.goods_notes,v:o.o((o=>d.localGoods.goods_notes=o.detail.value))}:{w:o.t(e.goods.goods_notes||"暂无备注")},{x:!d.isEditing},d.isEditing?{z:o.o(((...o)=>n.handleConfirm&&n.handleConfirm(...o))),A:o.o(((...o)=>n.handleCancel&&n.handleCancel(...o)))}:{y:o.o(((...o)=>n.handleEdit&&n.handleEdit(...o)))},{B:o.o(((...o)=>n.handleDelete&&n.handleDelete(...o))),C:o.o((()=>{})),D:o.o(((...o)=>n.cancel&&n.cancel(...o)))}):{})}]]);wx.createComponent(e);
