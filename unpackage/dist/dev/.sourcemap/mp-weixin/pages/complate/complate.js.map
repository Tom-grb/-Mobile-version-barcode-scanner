{"version":3,"file":"complate.js","sources":["pages/complate/complate.vue","../../AAAloaddown/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29tcGxhdGUvY29tcGxhdGUudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<!-- 扫码区域 -->\r\n\t\t<view class=\"camera-section\">\r\n\t\t\t<camera device-position=\"back\" flash=\"off\" class=\"camera\" mode=\"scanCode\"\r\n\t\t\t\t@scancode=\"handleScanWithThrottle\" />\r\n\t\t\t<view class=\"scan-overlay\">\r\n\t\t\t\t<view class=\"scan-line\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"scan-tips\">\r\n\t\t\t\t<text class=\"tips-text\">将商品二维码放入框内</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 商品列表 -->\r\n\t\t<view class=\"goods-section\">\r\n\t\t\t<view class=\"section-header\">\r\n\t\t\t\t<text class=\"section-title\">商品列表</text>\r\n\t\t\t</view>\r\n\r\n\t\t\t<scroll-view scroll-y class=\"goods-list\" v-if=\"goodsList.length > 0\">\r\n\t\t\t\t<view class=\"goods-item\" v-for=\"(item, index) in goodsList\" :key=\"index\"\r\n\t\t\t\t\t:class=\"{'slide-in': item.isNew}\">\r\n\t\t\t\t\t<view class=\"goods-info\">\r\n\t\t\t\t\t\t<text class=\"goods-name\">{{item.goods_name}}</text>\r\n\t\t\t\t\t\t<text class=\"goods-price\">￥{{item.goods_price}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"goods-action\">\r\n\t\t\t\t\t\t<view class=\"quantity-control\">\r\n\t\t\t\t\t\t\t<button class=\"qty-btn minus\" @click=\"updateQuantity(index, -1)\"\r\n\t\t\t\t\t\t\t\t:class=\"{'disabled': item.quantity <= 1}\">-</button>\r\n\t\t\t\t\t\t\t<text class=\"quantity\">{{item.quantity}}</text>\r\n\t\t\t\t\t\t\t<button class=\"qty-btn plus\" @click=\"updateQuantity(index, 1)\">+</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"delete-btn-wrapper\">\r\n\t\t\t\t\t\t\t<button class=\"delete-btn\" @click=\"removeItem(index)\">\r\n\t\t\t\t\t\t\t\t<text class=\"iconfont icon-delete\"></text>\r\n\t\t\t\t\t\t\t\t<text class=\"delete-text\">删除</text>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\r\n\t\t\t<!-- 空状态 -->\r\n\t\t\t<view class=\"empty-state\" v-else>\r\n\t\t\t\t<image class=\"empty-icon\" src=\"/static/empty-cart.png\"></image>\r\n\t\t\t\t<text class=\"empty-text\">暂无商品，请扫码添加</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\r\n\t\t<!-- 底部结算栏 -->\r\n\t\t<view class=\"footer\" :class=\"{'has-goods': goodsList.length > 0}\">\r\n\t\t\t<view class=\"total-info\">\r\n\t\t\t\t<button class=\"clear-btn\" @click=\"showClearConfirm\" v-if=\"goodsList.length > 0\">\r\n\t\t\t\t\t<text class=\"iconfont icon-delete\"></text>\r\n\t\t\t\t\t<text>清空</text>\r\n\t\t\t\t</button>\r\n\t\t\t\t<text class=\"total-label\">合计：</text>\r\n\t\t\t\t<text class=\"total-price\">￥{{totalPrice}}</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\tconst goodsInfoObj = uniCloud.importObject('goodsInfoObj')\r\n\timport {\r\n\t\tstore\r\n\t} from '@/uni_modules/uni-id-pages/common/store.js'\r\n\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tgoodsList: [],\r\n\t\t\t\tscanning: false,\r\n\t\t\t\tlastScanTime: 0\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\ttotalPrice() {\r\n\t\t\t\treturn this.goodsList.reduce((total, item) => {\r\n\t\t\t\t\treturn total + (item.goods_price * item.quantity)\r\n\t\t\t\t}, 0).toFixed(2)\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 添加限流处理方法\r\n\t\t\thandleScanWithThrottle(e) {\r\n\t\t\t\tconst currentTime = Date.now()\r\n\t\t\t\tif (this.scanning) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (currentTime - this.lastScanTime < 2000) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis.lastScanTime = currentTime\r\n\r\n\t\t\t\t// 调用原来的扫码处理方法\r\n\t\t\t\tthis.handleScan(e)\r\n\r\n\r\n\t\t\t},\r\n\r\n\t\t\tasync handleScan(e) {\r\n\t\t\t\tif (this.scanning) return\r\n\t\t\t\tthis.scanning = true\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst code = e.detail.result\r\n\t\t\t\t\tconsole.log('handleScan', code)\r\n\t\t\t\t\t// 检查是否已存在\r\n\t\t\t\t\tconst existingItem = this.goodsList.find(item => item.goods_sn === code)\r\n\t\t\t\t\tif (existingItem) {\r\n\t\t\t\t\t\t// 已存在则直接增加数量\r\n\t\t\t\t\t\tconst index = this.goodsList.indexOf(existingItem)\r\n\t\t\t\t\t\tthis.updateQuantity(index, 1)\r\n\t\t\t\t\t\tthis.scanning = false\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst res = await goodsInfoObj.findGoods(code)\r\n\r\n\t\t\t\t\tif (res.code === 0) {\r\n\t\t\t\t\t\tconst goods = res.data\r\n\t\t\t\t\t\t// 添加新商品\r\n\t\t\t\t\t\tthis.goodsList.unshift({\r\n\t\t\t\t\t\t\t...goods,\r\n\t\t\t\t\t\t\tquantity: 1,\r\n\t\t\t\t\t\t\tisNew: true\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t// 移除新商品标记（用于动画）\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tthis.goodsList[0].isNew = false\r\n\t\t\t\t\t\t}, 500)\r\n\r\n\t\t\t\t\t} else if (res.code === -1) {\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\t\turl: '/uni_modules/uni-id-pages/pages/login/login-withoutpwd'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}, 1000)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '商品不存在',\r\n\t\t\t\t\t\t\ticon: 'error'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '扫描失败',\r\n\t\t\t\t\t\ticon: 'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tthis.scanning = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateQuantity(index, change) {\r\n\t\t\t\tconst newQuantity = this.goodsList[index].quantity + change\r\n\t\t\t\tif (newQuantity < 1) return\r\n\r\n\t\t\t\tthis.goodsList[index].quantity = newQuantity\r\n\t\t\t},\r\n\t\t\tremoveItem(index) {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '确定要删除该商品吗？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tthis.goodsList.splice(index, 1)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tshowClearConfirm() {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '确定要清空所有商品吗？',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tthis.goodsList = []\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.container {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\theight: 100vh;\r\n\t\tbackground: #f5f5f5;\r\n\t}\r\n\r\n\t.camera-section {\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\theight: 350rpx;\r\n\t\tbackground: #000;\r\n\t}\r\n\r\n\t.camera {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.scan-overlay {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\twidth: 100%;\r\n\t\theight: 400rpx;\r\n\t\tborder: 2rpx solid rgba(255, 255, 255, 0.6);\r\n\t\tborder-radius: 20rpx;\r\n\t}\r\n\r\n\t.scan-line {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 4rpx;\r\n\t\tbackground: #007AFF;\r\n\t\tanimation: scan 2s linear infinite;\r\n\t}\r\n\r\n\t.scan-tips {\r\n\t\tposition: absolute;\r\n\t\tbottom: 40rpx;\r\n\t\tleft: 0;\r\n\t\tright: 0;\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.tips-text {\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 28rpx;\r\n\t\ttext-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.3);\r\n\t}\r\n\r\n\t.goods-section {\r\n\t\tflex: 1;\r\n\t\tpadding: 20rpx;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.section-header {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\r\n\t.section-title {\r\n\t\tfont-size: 32rpx;\r\n\t\tfont-weight: 600;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.clear-btn {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 5rpx 82rpx;\r\n\t\tbackground: #ff3b30;\r\n\t\tborder-radius: 15rpx;\r\n\t\tborder: none;\r\n\t}\r\n\r\n\t.clear-btn text {\r\n\t\tcolor: #fff;\r\n\t\tfont-size: 24rpx;\r\n\t}\r\n\r\n\t.goods-list {\r\n\t\theight: calc(100% - 80rpx);\r\n\t}\r\n\r\n\t.goods-item {\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 16rpx;\r\n\t\tpadding: 24rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t\tanimation: slideIn 0.3s ease-out;\r\n\t}\r\n\r\n\t.goods-item.slide-in {\r\n\t\tanimation: slideInNew 0.5s ease-out;\r\n\t}\r\n\r\n\t.goods-info {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 16rpx;\r\n\t}\r\n\r\n\t.goods-name {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.goods-price {\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #ff3b30;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\r\n\t.goods-action {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tflex: 1;\r\n\t}\r\n\r\n\t.quantity-control {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tbackground: #f5f5f5;\r\n\t\tborder-radius: 8rpx;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.qty-btn {\r\n\t\twidth: 60rpx;\r\n\t\theight: 60rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tbackground: none;\r\n\t\tborder: none;\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.qty-btn.disabled {\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.quantity {\r\n\t\twidth: 80rpx;\r\n\t\ttext-align: center;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n\r\n\t.delete-btn-wrapper {\r\n\t\tmargin-left: 20rpx;\r\n\t}\r\n\r\n\t.delete-btn {\r\n\t\tmin-width: 120rpx;\r\n\t\theight: 60rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tbackground: #ff3b30;\r\n\t\tborder-radius: 8rpx;\r\n\t\tborder: none;\r\n\t\tpadding: 0 20rpx;\r\n\t}\r\n\r\n\t.delete-btn .icon-delete {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #fff;\r\n\t\tmargin-right: 8rpx;\r\n\t}\r\n\r\n\t.delete-btn .delete-text {\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #fff;\r\n\t}\r\n\r\n\t.empty-state {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.empty-icon {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\t\tmargin-bottom: 20rpx;\r\n\t}\r\n\r\n\t.empty-text {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.footer {\r\n\t\tpadding: 20rpx 32rpx;\r\n\t\tbackground: #fff;\r\n\t\ttransform: translateY(100%);\r\n\t\ttransition: transform 0.3s ease-out;\r\n\t}\r\n\r\n\t.footer.has-goods {\r\n\t\ttransform: translateY(0);\r\n\t}\r\n\r\n\t.total-info {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: space-between;\r\n\t}\r\n\r\n\t.total-label {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #666;\r\n\t\tmargin-left: auto;\r\n\t\tmargin-right: 20rpx;\r\n\t}\r\n\r\n\t.total-price {\r\n\t\tfont-size: 40rpx;\r\n\t\tcolor: #ff3b30;\r\n\t\tfont-weight: 600;\r\n\t}\r\n\r\n\t@keyframes scan {\r\n\t\t0% {\r\n\t\t\ttop: 0;\r\n\t\t}\r\n\r\n\t\t50% {\r\n\t\t\ttop: 100%;\r\n\t\t}\r\n\r\n\t\t100% {\r\n\t\t\ttop: 0;\r\n\t\t}\r\n\t}\r\n\r\n\t@keyframes slideIn {\r\n\t\tfrom {\r\n\t\t\topacity: 0;\r\n\t\t\ttransform: translateY(20rpx);\r\n\t\t}\r\n\r\n\t\tto {\r\n\t\t\topacity: 1;\r\n\t\t\ttransform: translateY(0);\r\n\t\t}\r\n\t}\r\n\r\n\t@keyframes slideInNew {\r\n\t\tfrom {\r\n\t\t\topacity: 0;\r\n\t\t\ttransform: translateX(-100%);\r\n\t\t}\r\n\r\n\t\tto {\r\n\t\t\topacity: 1;\r\n\t\t\ttransform: translateX(0);\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from 'D:/weixin_pj/扫一扫/pages/complate/complate.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni","e"],"mappings":";;;;AAkEC,MAAM,eAAeA,cAAAA,GAAS,aAAa,cAAc;AAKzD,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,WAAW,CAAE;AAAA,MACb,UAAU;AAAA,MACV,cAAc;AAAA,IACf;AAAA,EACA;AAAA,EACD,UAAU;AAAA,IACT,aAAa;AACZ,aAAO,KAAK,UAAU,OAAO,CAAC,OAAO,SAAS;AAC7C,eAAO,QAAS,KAAK,cAAc,KAAK;AAAA,MACzC,GAAG,CAAC,EAAE,QAAQ,CAAC;AAAA,IAChB;AAAA,EACA;AAAA,EACD,SAAS;AAAA;AAAA,IAER,uBAAuB,GAAG;AACzB,YAAM,cAAc,KAAK,IAAI;AAC7B,UAAI,KAAK,UAAU;AAClB;AAAA,MACD;AAEA,UAAI,cAAc,KAAK,eAAe,KAAM;AAC3C;AAAA,MACD;AACA,WAAK,eAAe;AAGpB,WAAK,WAAW,CAAC;AAAA,IAGjB;AAAA,IAED,MAAM,WAAW,GAAG;AACnB,UAAI,KAAK;AAAU;AACnB,WAAK,WAAW;AAChB,UAAI;AACH,cAAM,OAAO,EAAE,OAAO;AACtBC,sBAAAA,MAAA,MAAA,OAAA,sCAAY,cAAc,IAAI;AAE9B,cAAM,eAAe,KAAK,UAAU,KAAK,UAAQ,KAAK,aAAa,IAAI;AACvE,YAAI,cAAc;AAEjB,gBAAM,QAAQ,KAAK,UAAU,QAAQ,YAAY;AACjD,eAAK,eAAe,OAAO,CAAC;AAC5B,eAAK,WAAW;AAChB;AAAA,QACD;AAEA,cAAM,MAAM,MAAM,aAAa,UAAU,IAAI;AAE7C,YAAI,IAAI,SAAS,GAAG;AACnB,gBAAM,QAAQ,IAAI;AAElB,eAAK,UAAU,QAAQ;AAAA,YACtB,GAAG;AAAA,YACH,UAAU;AAAA,YACV,OAAO;AAAA,WACP;AAGD,qBAAW,MAAM;AAChB,iBAAK,UAAU,CAAC,EAAE,QAAQ;AAAA,UAC1B,GAAE,GAAG;AAAA,QAEL,WAAS,IAAI,SAAS,IAAI;AAC3B,qBAAW,MAAM;AAChBA,0BAAAA,MAAI,WAAW;AAAA,cACd,KAAK;AAAA,aACL;AAAA,UACD,GAAE,GAAI;AAAA,eACD;AACNA,wBAAAA,MAAI,UAAU;AAAA,YACb,OAAO;AAAA,YACP,MAAM;AAAA,WACN;AAAA,QACF;AAAA,MACD,SAASC,IAAG;AACXD,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,MAAM;AAAA,SACN;AAAA,MACF,UAAU;AACT,aAAK,WAAW;AAAA,MACjB;AAAA,IACA;AAAA,IACD,eAAe,OAAO,QAAQ;AAC7B,YAAM,cAAc,KAAK,UAAU,KAAK,EAAE,WAAW;AACrD,UAAI,cAAc;AAAG;AAErB,WAAK,UAAU,KAAK,EAAE,WAAW;AAAA,IACjC;AAAA,IACD,WAAW,OAAO;AACjBA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChB,iBAAK,UAAU,OAAO,OAAO,CAAC;AAAA,UAC/B;AAAA,QACD;AAAA,OACA;AAAA,IACD;AAAA,IACD,mBAAmB;AAClBA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AACjB,cAAI,IAAI,SAAS;AAChB,iBAAK,YAAY,CAAC;AAAA,UACnB;AAAA,QACD;AAAA,OACA;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC1LD,GAAG,WAAW,eAAe;"}