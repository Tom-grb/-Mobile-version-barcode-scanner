{"version":3,"file":"complate.js","sources":["pages/complate/complate.vue","../../AAAloaddown/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29tcGxhdGUvY29tcGxhdGUudnVl"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<!-- 扫码区域 -->\n\t\t<view class=\"camera-section\">\n\t\t\t<camera \n\t\t\t\tdevice-position=\"back\" \n\t\t\t\tflash=\"off\" \n\t\t\t\tclass=\"camera\"\n\t\t\t\tmode=\"scanCode\"\n\t\t\t\t@scancode=\"handleScanWithThrottle\"\n\t\t\t/>\n\t\t\t<view class=\"scan-overlay\">\n\t\t\t\t<view class=\"scan-line\"></view>\n\t\t\t</view>\n\t\t\t<view class=\"scan-tips\">\n\t\t\t\t<text class=\"tips-text\">将商品二维码放入框内</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 商品列表 -->\n\t\t<view class=\"goods-section\">\n\t\t\t<view class=\"section-header\">\n\t\t\t\t<text class=\"section-title\">商品列表</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<scroll-view \n\t\t\t\tscroll-y \n\t\t\t\tclass=\"goods-list\"\n\t\t\t\tv-if=\"goodsList.length > 0\"\n\t\t\t>\n\t\t\t\t<view \n\t\t\t\t\tclass=\"goods-item\"\n\t\t\t\t\tv-for=\"(item, index) in goodsList\" \n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:class=\"{'slide-in': item.isNew}\"\n\t\t\t\t>\n\t\t\t\t\t<view class=\"goods-info\">\n\t\t\t\t\t\t<text class=\"goods-name\">{{item.goods_name}}</text>\n\t\t\t\t\t\t<text class=\"goods-price\">￥{{item.goods_price}}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<view class=\"goods-action\">\n\t\t\t\t\t\t<view class=\"quantity-control\">\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tclass=\"qty-btn minus\" \n\t\t\t\t\t\t\t\t@click=\"updateQuantity(index, -1)\"\n\t\t\t\t\t\t\t\t:class=\"{'disabled': item.quantity <= 1}\"\n\t\t\t\t\t\t\t>-</button>\n\t\t\t\t\t\t\t<text class=\"quantity\">{{item.quantity}}</text>\n\t\t\t\t\t\t\t<button \n\t\t\t\t\t\t\t\tclass=\"qty-btn plus\" \n\t\t\t\t\t\t\t\t@click=\"updateQuantity(index, 1)\"\n\t\t\t\t\t\t\t>+</button>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<view class=\"delete-btn-wrapper\">\n\t\t\t\t\t\t\t<button class=\"delete-btn\" @click=\"removeItem(index)\">\n\t\t\t\t\t\t\t\t<text class=\"iconfont icon-delete\"></text>\n\t\t\t\t\t\t\t\t<text class=\"delete-text\">删除</text>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</scroll-view>\n\t\t\t\n\t\t\t<!-- 空状态 -->\n\t\t\t<view class=\"empty-state\" v-else>\n\t\t\t\t<image class=\"empty-icon\" src=\"/static/empty-cart.png\"></image>\n\t\t\t\t<text class=\"empty-text\">暂无商品，请扫码添加</text>\n\t\t\t</view>\n\t\t</view>\n\t\t\n\t\t<!-- 底部结算栏 -->\n\t\t<view class=\"footer\" :class=\"{'has-goods': goodsList.length > 0}\">\n\t\t\t<view class=\"total-info\">\n\t\t\t\t<button class=\"clear-btn\" @click=\"showClearConfirm\" v-if=\"goodsList.length > 0\">\n\t\t\t\t\t<text class=\"iconfont icon-delete\"></text>\n\t\t\t\t\t<text>清空</text>\n\t\t\t\t</button>\n\t\t\t\t<text class=\"total-label\">合计：</text>\n\t\t\t\t<text class=\"total-price\">￥{{totalPrice}}</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nconst goodsInfoObj = uniCloud.importObject('goodsInfoObj')\nimport { store } from '@/uni_modules/uni-id-pages/common/store.js'\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tgoodsList: [],\n\t\t\tscanning: false,\n\t\t\tlastScanTime: 0\n\t\t}\n\t},\n\tcomputed: {\n\t\ttotalPrice() {\n\t\t\treturn this.goodsList.reduce((total, item) => {\n\t\t\t\treturn total + (item.goods_price * item.quantity)\n\t\t\t}, 0).toFixed(2)\n\t\t}\n\t},\n\tmethods: {\n\t\tcheckLogin() {\n\t\t\tif (!store.hasLogin) {\n\t\t\t\tuni.navigateTo({\n\t\t\t\t\turl: '/uni_modules/uni-id-pages/pages/login/login-withoutpwd'\n\t\t\t\t})\n\t\t\t\treturn false\n\t\t\t}\n\t\t\treturn true\n\t\t},\n\n\t\t// 添加限流处理方法\n\t\thandleScanWithThrottle(e) {\n\t\t\tif (!this.checkLogin()){\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconsole.log('扫码结果：', e.detail.result)\n\t\t\tconst currentTime = Date.now()\n\t\t\tif (this.scanning) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\t\n\t\t\tif (currentTime - this.lastScanTime < 2000) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconsole.log('整备调用')\n\t\t\tthis.lastScanTime = currentTime\n\t\t\t\n\t\t\t// 调用原来的扫码处理方法\n\t\t\tthis.handleScan(e)\n\t\t\t\n\t\t\t\n\t\t},\n\n\t\tasync handleScan(e) {\n\t\t\tif (this.scanning) return\n\t\t\tthis.scanning = true\n\t\t\ttry {\n\t\t\t\tconst code = e.detail.result\n\t\t\t\tconsole.log('handleScan', code)\n\t\t\t\t// 检查是否已存在\n\t\t\t\tconst existingItem = this.goodsList.find(item => item.goods_sn === code)\n\t\t\t\tif (existingItem) {\n\t\t\t\t\t// 已存在则直接增加数量\n\t\t\t\t\tconst index = this.goodsList.indexOf(existingItem)\n\t\t\t\t\tthis.updateQuantity(index, 1)\n\t\t\t\t\tthis.scanning = false\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst res = await goodsInfoObj.findGoods(code)\n\t\t\t\t\n\t\t\t\tif (res.code === 0) {\n\t\t\t\t\tconst goods = res.data\n\t\t\t\t\t// 添加新商品\n\t\t\t\t\tthis.goodsList.unshift({\n\t\t\t\t\t\t...goods,\n\t\t\t\t\t\tquantity: 1,\n\t\t\t\t\t\tisNew: true\n\t\t\t\t\t})\n\t\t\t\t\t\n\t\t\t\t\t// 移除新商品标记（用于动画）\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tthis.goodsList[0].isNew = false\n\t\t\t\t\t}, 500)\n\t\t\t\t\t\n\t\t\t\t} else {\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: '商品不存在',\n\t\t\t\t\t\ticon: 'error'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t} catch(e) {\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: '扫描失败',\n\t\t\t\t\ticon: 'error'\n\t\t\t\t})\n\t\t\t} finally {\n\t\t\t\tthis.scanning = false\n\t\t\t}\n\t\t},\n\t\tupdateQuantity(index, change) {\n\t\t\tconst newQuantity = this.goodsList[index].quantity + change\n\t\t\tif (newQuantity < 1) return\n\t\t\t\n\t\t\tthis.goodsList[index].quantity = newQuantity\n\t\t},\n\t\tremoveItem(index) {\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '提示',\n\t\t\t\tcontent: '确定要删除该商品吗？',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\tthis.goodsList.splice(index, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tshowClearConfirm() {\n\t\t\tuni.showModal({\n\t\t\t\ttitle: '提示',\n\t\t\t\tcontent: '确定要清空所有商品吗？',\n\t\t\t\tsuccess: (res) => {\n\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\tthis.goodsList = []\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n}\n</script>\n\n<style>\n.container {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100vh;\n\tbackground: #f5f5f5;\n}\n\n.camera-section {\n\tposition: relative;\n\twidth: 100%;\n\theight: 350rpx;\n\tbackground: #000;\n}\n\n.camera {\n\twidth: 100%;\n\theight: 100%;\n}\n\n.scan-overlay {\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n\twidth: 100%;\n\theight: 400rpx;\n\tborder: 2rpx solid rgba(255, 255, 255, 0.6);\n\tborder-radius: 20rpx;\n}\n\n.scan-line {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 4rpx;\n\tbackground: #007AFF;\n\tanimation: scan 2s linear infinite;\n}\n\n.scan-tips {\n\tposition: absolute;\n\tbottom: 40rpx;\n\tleft: 0;\n\tright: 0;\n\ttext-align: center;\n}\n\n.tips-text {\n\tcolor: #fff;\n\tfont-size: 28rpx;\n\ttext-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.3);\n}\n\n.goods-section {\n\tflex: 1;\n\tpadding: 20rpx;\n\toverflow: hidden;\n}\n\n.section-header {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 20rpx;\n}\n\n.section-title {\n\tfont-size: 32rpx;\n\tfont-weight: 600;\n\tcolor: #333;\n}\n\n.clear-btn {\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 5rpx 82rpx;\n\tbackground: #ff3b30;\n\tborder-radius: 15rpx;\n\tborder: none;\n}\n\n.clear-btn text {\n\tcolor: #fff;\n\tfont-size: 24rpx;\n}\n\n.goods-list {\n\theight: calc(100% - 80rpx);\n}\n\n.goods-item {\n\tbackground: #fff;\n\tborder-radius: 16rpx;\n\tpadding: 24rpx;\n\tmargin-bottom: 20rpx;\n\tanimation: slideIn 0.3s ease-out;\n}\n\n.goods-item.slide-in {\n\tanimation: slideInNew 0.5s ease-out;\n}\n\n.goods-info {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 16rpx;\n}\n\n.goods-name {\n\tfont-size: 28rpx;\n\tcolor: #333;\n}\n\n.goods-price {\n\tfont-size: 32rpx;\n\tcolor: #ff3b30;\n\tfont-weight: 500;\n}\n\n.goods-action {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tflex: 1;\n}\n\n.quantity-control {\n\tdisplay: flex;\n\talign-items: center;\n\tbackground: #f5f5f5;\n\tborder-radius: 8rpx;\n\toverflow: hidden;\n}\n\n.qty-btn {\n\twidth: 60rpx;\n\theight: 60rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground: none;\n\tborder: none;\n\tfont-size: 28rpx;\n\tcolor: #333;\n}\n\n.qty-btn.disabled {\n\tcolor: #999;\n}\n\n.quantity {\n\twidth: 80rpx;\n\ttext-align: center;\n\tfont-size: 28rpx;\n}\n\n.delete-btn-wrapper {\n\tmargin-left: 20rpx;\n}\n\n.delete-btn {\n\tmin-width: 120rpx;\n\theight: 60rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tbackground: #ff3b30;\n\tborder-radius: 8rpx;\n\tborder: none;\n\tpadding: 0 20rpx;\n}\n\n.delete-btn .icon-delete {\n\tfont-size: 28rpx;\n\tcolor: #fff;\n\tmargin-right: 8rpx;\n}\n\n.delete-btn .delete-text {\n\tfont-size: 24rpx;\n\tcolor: #fff;\n}\n\n.empty-state {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tjustify-content: center;\n\theight: 100%;\n}\n\n.empty-icon {\n\twidth: 200rpx;\n\theight: 200rpx;\n\tmargin-bottom: 20rpx;\n}\n\n.empty-text {\n\tfont-size: 28rpx;\n\tcolor: #999;\n}\n\n.footer {\n\tpadding: 20rpx 32rpx;\n\tbackground: #fff;\n\ttransform: translateY(100%);\n\ttransition: transform 0.3s ease-out;\n}\n\n.footer.has-goods {\n\ttransform: translateY(0);\n}\n\n.total-info {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.total-label {\n\tfont-size: 28rpx;\n\tcolor: #666;\n\tmargin-left: auto;\n\tmargin-right: 20rpx;\n}\n\n.total-price {\n\tfont-size: 40rpx;\n\tcolor: #ff3b30;\n\tfont-weight: 600;\n}\n\n@keyframes scan {\n\t0% {\n\t\ttop: 0;\n\t}\n\t50% {\n\t\ttop: 100%;\n\t}\n\t100% {\n\t\ttop: 0;\n\t}\n}\n\n@keyframes slideIn {\n\tfrom {\n\t\topacity: 0;\n\t\ttransform: translateY(20rpx);\n\t}\n\tto {\n\t\topacity: 1;\n\t\ttransform: translateY(0);\n\t}\n}\n\n@keyframes slideInNew {\n\tfrom {\n\t\topacity: 0;\n\t\ttransform: translateX(-100%);\n\t}\n\tto {\n\t\topacity: 1;\n\t\ttransform: translateX(0);\n\t}\n}\n</style>\n","import MiniProgramPage from 'D:/weixin_pj/扫一扫/pages/complate/complate.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","store","uni","e"],"mappings":"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"}