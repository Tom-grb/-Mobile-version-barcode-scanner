{"version":3,"file":"list.js","sources":["pages/list/list.vue","../../AAAloaddown/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbGlzdC9saXN0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"goods-list-page\">\n    <!-- 直接在页面中展示商品列表，不使用 scroll-view -->\n    <view v-if=\"goodsList.length > 0\">\n      <view class=\"goods-item\" v-for=\"item in goodsList\" :key=\"item._id\" @click=\"showGoodsDetail(item)\">\n        <goods-item :item=\"item\"></goods-item>\n      </view>\n\n      <!-- 加载更多 -->\n      <view class=\"load-more\" v-if=\"isLoading\">\n        <text class=\"loading-text\">加载中...</text>\n      </view>\n      <view class=\"no-more\" v-else>\n        <text class=\"no-more-text\">没有更多了</text>\n      </view>\n    </view>\r\n\t<view class=\"nothing\">\r\n\t\t--您还未添加商品--\r\n\t</view>\n\n    <!-- 商品详情弹窗 -->\n    <goods-popup :show=\"showPopup\" :goods=\"currentGoods\" @update:show=\"showPopup = $event\" @refresh=\"refreshList\" />\n  </view>\n</template>\n\n<script>\nconst goodsCloudObj = uniCloud.importObject('goodsInfoObj');\nexport default {\n  data() {\n    return {\n      goodsList: [], // 存储商品列表数据\n      page: 1, // 当前页码\n      pageSize: 20, // 每页数据量\n      isLoading: false, // 是否正在加载数据\n      isNoMore: false, // 是否已经没有更多数据\n      showPopup: false,\n      currentGoods: {}\n    };\n  },\n  onLoad() {\n    this.getGoods();\n  },\n  onPullDownRefresh() {\n    console.log(123);\n    this.page = 1;\n    this.pageSize = 20;\r\n\tthis.goodsList = []\r\n\tthis.isNoMore = false\n    this.getGoods();\n  },\r\n  onReachBottom() {\r\n  \tconsole.log('bottom')\r\n    this.getGoods();\r\n  },\n  methods: {\n    async getGoods() {\n      if (this.isLoading || this.isNoMore) {\n        return;\n      }\n      this.isLoading = true;\n      const result = await goodsCloudObj.getGoodsList({\n        page: this.page,\n        pageSize: this.pageSize\n      });\n\n      if (result.code === 0) {\n        if (result.data.length < this.pageSize) {\n          this.isNoMore = true;\n        }\n        this.goodsList = [...this.goodsList, ...result.data];\n        this.page++;\n      } else if(result.code === -1) {\n        uni.showToast({\n          title: '未登录/登录过期',\n          icon: 'none'\n        });\r\n\t\tsetTimeout(()=>{\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: '/uni_modules/uni-id-pages/pages/login/login-withoutpwd'\r\n\t\t\t})\r\n\t\t},1000)\r\n\t\treturn\n      }else{\r\n\t\t  uni.showToast({\r\n\t\t    title: result.msg,\r\n\t\t    icon: 'none'\r\n\t\t  });\r\n\t  }\n      // 数据获取完成，停止下拉刷新动画\n      uni.stopPullDownRefresh();\n      this.isLoading = false;\n    },\n   \n    showGoodsDetail(goods) {\n      this.currentGoods = goods;\n      this.showPopup = true;\n    },\n    refreshList() {\n      this.page = 1;\n      this.pageSize = 20;\r\n\t  this.goodsList = []\r\n\t  this.isNoMore = false\n      this.getGoods();\n      this.showPopup = false;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n.goods-list-page {\n  padding: 20rpx;\n}\n\n.goods-item {\n  border: 1rpx solid #ccc;\n  padding: 10rpx;\n  border-radius: 20rpx;\n  margin-bottom: 10rpx;\n}\r\n\r\n.nothing{\r\n\tpadding: 30rpx 0;\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n}\n\n.load-more,\n.no-more {\n  text-align: center;\n  padding: 30rpx 0;\n}\n\n.loading-text,\n.no-more-text {\n  font-size: 24rpx;\n  color: #999;\n}\n</style>","import MiniProgramPage from 'D:/weixin_pj/扫一扫/pages/list/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":";;AA0BA,MAAM,gBAAgBA,cAAQ,GAAC,aAAa,cAAc;AAC1D,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,WAAW,CAAE;AAAA;AAAA,MACb,MAAM;AAAA;AAAA,MACN,UAAU;AAAA;AAAA,MACV,WAAW;AAAA;AAAA,MACX,UAAU;AAAA;AAAA,MACV,WAAW;AAAA,MACX,cAAc,CAAC;AAAA;EAElB;AAAA,EACD,SAAS;AACP,SAAK,SAAQ;AAAA,EACd;AAAA,EACD,oBAAoB;AAClBC,kBAAAA,MAAA,MAAA,OAAA,6BAAY,GAAG;AACf,SAAK,OAAO;AACZ,SAAK,WAAW;AACnB,SAAK,YAAY,CAAC;AAClB,SAAK,WAAW;AACb,SAAK,SAAQ;AAAA,EACd;AAAA,EACD,gBAAgB;AACfA,kBAAAA,MAAY,MAAA,OAAA,6BAAA,QAAQ;AACnB,SAAK,SAAQ;AAAA,EACd;AAAA,EACD,SAAS;AAAA,IACP,MAAM,WAAW;AACf,UAAI,KAAK,aAAa,KAAK,UAAU;AACnC;AAAA,MACF;AACA,WAAK,YAAY;AACjB,YAAM,SAAS,MAAM,cAAc,aAAa;AAAA,QAC9C,MAAM,KAAK;AAAA,QACX,UAAU,KAAK;AAAA,MACjB,CAAC;AAED,UAAI,OAAO,SAAS,GAAG;AACrB,YAAI,OAAO,KAAK,SAAS,KAAK,UAAU;AACtC,eAAK,WAAW;AAAA,QAClB;AACA,aAAK,YAAY,CAAC,GAAG,KAAK,WAAW,GAAG,OAAO,IAAI;AACnD,aAAK;AAAA,MACL,WAAQ,OAAO,SAAS,IAAI;AAC5BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACR,CAAC;AACP,mBAAW,MAAI;AACdA,wBAAAA,MAAI,WAAW;AAAA,YACd,KAAK;AAAA,WACL;AAAA,QACD,GAAC,GAAI;AACN;AAAA,aACS;AACPA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO,OAAO;AAAA,UACd,MAAM;AAAA,QACR,CAAC;AAAA,MACF;AAEGA,oBAAG,MAAC,oBAAmB;AACvB,WAAK,YAAY;AAAA,IAClB;AAAA,IAED,gBAAgB,OAAO;AACrB,WAAK,eAAe;AACpB,WAAK,YAAY;AAAA,IAClB;AAAA,IACD,cAAc;AACZ,WAAK,OAAO;AACZ,WAAK,WAAW;AACnB,WAAK,YAAY,CAAC;AAClB,WAAK,WAAW;AACb,WAAK,SAAQ;AACb,WAAK,YAAY;AAAA,IACnB;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzGA,GAAG,WAAW,eAAe;"}